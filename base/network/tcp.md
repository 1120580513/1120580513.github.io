# TCP

---

## 三次握手
1. 客户端发送一个带SYN标志的TCP报文到服务器。这是三次握手过程中的报文1。
2. 服务器端回应客户端的，这是三次握手中的第2个报文，这个报文同时带ACK标志和SYN标志。因此它表示对刚才客户端SYN报文的回应；同时又标志SYN给客户端，询问客户端是否准备好进行数据通讯。
3. 客户必须再次回应服务段一个ACK报文，这是报文段3。

> **为了防止ACK报文的丢失，主动关闭连接的那一方在挥手后会进入Time_Wait状态2MSL，所以会有报文段3。**

## 四次挥手
1. TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送（报文段4）。
2. 服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1（报文段5）。和SYN一样，一个FIN将占用一个序号。
3. 服务器关闭客户端的连接，发送一个FIN给客户端（报文段6）。
4. 客户段发回ACK报文确认，并将确认序号设置为收到序号加1（报文段7）

> **由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。**
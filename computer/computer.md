# Computer Systems

---

## 计算机系统
- `比特(bit)`：0 或 1
- `字节(byte)`： 8个比特
- `cpp(预处理器)` `ccl(编译器)` `as(汇编器)` `ld(链接器)`
- `CPU(中央处理单元)` `PC(程序计数器)` `ALU(算术/逻辑单元)` `USB(通用串行总线)`
- `DRAM(动态随机存取存储器)` `SRAM(静态随机访问器)`
- `DMA(直接存储器存取)`
- `机械原理`： *较大的存储设备要比较小的存储设备运行的慢,而快速设备的造价远高于同类的低速设备*
- `虚拟机`： *对计算机的抽象*

```cpp
#include <stdio.h>

int main()
{
  printf("hello word\n");
  return 0;
}
```
### 源文件到目标文件的过程
1. hello.c *源文件，文本*
2. hello.i *预处理器(cpp)修改原文件(修改#开头的文件)，文本*
3. hello.s *编译器(ccl)将hello.i翻译成hello.s,翻译成汇编语言，文本*
4. hello.o *汇编器(as)将hello.s翻译成机器语言指令并打包成可重定位目标程序的格式，二进制文件*
5. hello *链接器(ld)将程序中的外部函数的预编译的目标文件合并得到可执行程序，二进制文件*

### 硬件组成
 * **总线**： *贯穿整个系统的电子管道，负责在和部件间传递字节信息*
 * **I/O设备**： *系统与外部的联系通道(如：键盘、鼠标 显示器、磁盘)，每个I/O设备都通过一个控制器或适配器与I/O总线相连(控制器是I/O设备本身或主板上的芯片组，适配器则是插在主板上的卡)*
 * **主存**： *临时的存储设备,在处理器执行程序时,用来存放程序和程序处理的数据,由一组动态随机存取存储器(DRAM)组成,是一个线性字节数组*
 * **处理器**： *中央处理单元(CPU),执行存储在主存中存储的引擎,核心是大小为一字节的存储设备(或寄存器),称为程序计数器(PC)*
### 目标文件的执行过程(无缓存)
1. CPU执行shell的指令,等待用户输入字符
2. 输入hello.exe(each in 'hello.exe'：USB -> I/O总线 -> I/O桥 -> 系统总线 -> 总线接口 -> 寄存器文件 -> 总线接口 -> 系统总线 -> I/O桥 -> 主存储器)
3. 通过直接存储器读取文件,将hello.exe的代码和数据复制到主存(磁盘控制器 -> I/O桥 -> 内存总线 -> 主存设备)
4. 执行man函数的机器语言指令,将"hello word\n"，从主存复制到寄存器文件，再从寄存器文件复制到显示设备

- > **系统花费大量时间把信息从一个地方挪到另一个地方,减慢了程序的"真正"工作**
- > 根据机械原理：**较大的存储设备要比较小的存储设备运行的慢,而快速设备的造价远高于同类的低速设备**
- > **处理器从寄存器文件中读数据要比从主存中读数据快的多的多**
- > 系统设计者采用了更小更快的存储设备(高速缓存存储器)
### 存储设备结构
1. `L0(寄存器)`：*保存来自高速缓存存储器的字节*
2. `L1(L1高速缓存:SRAM)`：*保存取自L2的高速缓存行*
3. `L2(L2高速缓存:SRAM)`：*保存取自L3的高速缓存行*
4. `L3(L3高速缓存:SRAM)`：*保存取自主存的高速缓存行*
5. `L4(主存)`：*保存取自本地磁盘的磁盘块*
6. `L5(本地二级存储:本地磁盘)`：*保存取自远程服务器上的磁盘文件*
7. `L6(远程二级服务器)`

### 操作系统管理硬件
 * **防止硬件被失控的应用程序滥用**
 * **向而应用程序提供简单一致的机制来控制低级硬件设备**
 > 操作系统通过进程、虚拟内存、文件来实现以上基本功能
 #### 进程
 - `进程`：**对一个正在运行的程序的抽象**使程序看上去好像独占地使用处理器、主存、I/O设备
 - `上下文`：**操作系统保持跟踪进程运行所需的所有状态信息**这种状态就是上下文
 - `并发运行`：**一个进程的指令和另一个进程的指令是交错执行的**
 - `上下文切换`: **保存当前进程的上下文，恢复新进程的上下文，然后将控制权转给新进程**
 - `系统内核`: **操作系统代码常驻主存部分，是系统管理全部进程所用代码和数据结构的集合**
 > 单核处理器在一个时刻只能执行一个程序，多核处理器同一时刻能执行多个程序
 #### 线程
 `线程`：**一个进程可以由多个线程的执行单元组成，都运行在进程的上下文中，并共享同样的代码和数据结构**
 #### 虚拟内存
 - `虚拟内存`：**对程序存储器的抽象**
 - `虚拟地址空间`：*进程看到的内存都是一致的，由大量准确定义的区构成，每个区都有专门的功能*
  ##### 进程的内存地址结构(区)
  * **内核虚拟内存** *顶级区域*
  * **用户栈** *编译器用它来实现函数调用(每调用一个函数，栈就增长，从一个函数返回时，栈就减少)*
  * **共享库** *存放像C标准库和数学库这样的共享库的代码和数据的区域*
  * **运行时堆** *存放运行时的数据*
  * **程序代码和数据** *进程开始运行时按照可执行目标文件的内容初始化*
  * **0**
 #### 文件
 `文件`：**对I/O设备的抽象**
 #### 网络
 `网络`：**可视为一个I/O设备** *当系统从主存复制一串字节到网络适配器时，数据流经过网络到达另一台机器*
 #### Amdahl定律
 `Amdahl定律`：**当对系统的某个部分加速时，对系统整体性能的影响取决于该部分的重要性和加速速度**
 > S = 1 / (1- a) + a/k （a：该部分所需执行时间/系统整体执行时间，k：该部分性能提升比例）
 > 要想显著加速整个系统，必须提升全系统中相当大的部分的速度
 #### 并发和并行
 - `并发`：**同时具有多个活动的系统**
 - `并行`：**并发来使系统运行的更快**
 ##### 线程级并发
  ###### 多核处理器
  > 多核处理器由多个CPU核和L3高速缓存组成，每个核都有自己的L1数据高速缓存、L1指令高速缓存、L2高速缓存
  > 减少了在执行多个任务时模拟并发的需求、当程序以多线程方式编写时线程可以并行地高效执行
 ##### 指令级并行
 - `指令级并行`：**处理器可以同时执行多条指令**
 - `流水线`：**将一条指令所需要的活动分成不同的步骤，将CPU的硬件组织成一系列的阶段，每个阶段执行一个步骤，这些阶段可以并发的操作**
 - `超标量`：**处理器的执行速率达到比一个周期一条指令更快**
 >
 ##### 单指令、多数据并行
 `单指令、多数据并行(SIMD并行)`：**允许一条指令产生多个可并行执行的操作** *大多是为了提高处理影像、声音、视频数据应用的效率*
### 计算机系统的抽象
|虚拟机|
----|----|----|----|
|操作系统|进程     |
|       |指令集架构|虚拟内存|
|       |处理器|主存|文件|
|       |     |    |I/O设备|


## 程序结构和执行
### 信息的表示和处理
### 程序的机器级表示
### 处理器体系结构
### 优化程序性能
### 存储器层次结构

## 在系统上运行程序
### 链接
### 异常控制流

## 程序间的交互和通信
### 系统级I/O
### 网络编程
### 并发编程
